{"_id":"umv1uae2iSuUkZV6","name":"IdentifyPokemon","permission":{"default":0,"7I9uXQmgFHFdAgSd":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"// NOTICE: This macro requires The Furnace module to work properly\r\n// IdentifyPokemon @target @scene @item\r\nlet mode = args[0];\r\nlet targetid = args[1] || '';\r\nlet sceneid = args[2] || '';\r\nlet item = args[3] || '';\r\n\r\n// fixes for items with no activation time or duration set\r\n// required for DynamicEffects to run the macro\r\nif (item != '' && item.data && ! item.data.activation) {\r\n\titem.data.activation = {\r\n\t      \"type\": \"bonus\",\r\n\t      \"cost\": 1,\r\n\t      \"condition\": \"creature must be concious and within 50 ft.\"\r\n\t};\r\n}\r\nif (item != '' && item.data && ! item.data.duration) {\r\n\titem.data.duration = {\r\n\t      \"value\": null,\r\n\t      \"units\": \"inst\"\r\n    };\r\n}\r\n\r\nlet targetactor = (targetid == '' || sceneid == '') ? _token.actor : game.actors.get(game.scenes.get(sceneid).data.tokens.filter(t => t._id == targetid)[0].actorId);\r\n\r\n\r\nif (targetactor) {\r\n\tlet basesr = targetactor.data.data.details.alignment;\r\n\tlet description = targetactor.data.data.details.biography.value;\r\n\tlet chatData = {\r\n\t  user: game.user._id,\r\n\t  speaker: ChatMessage.getSpeaker({alias:(item.name || 'Pokedex')}),\r\n\t  content: `<div class=\"dnd5e red-full chat-card\" data-actor-id=\"${targetactor.id}\" data-critical=\"false\">\r\n\t<div><div class=\"dnd5e chat-card item-card\">\r\n\t<header class=\"card-header flexrow red-header\">\r\n\t\t<img src=\"${(item.img || targetactor.img)}\" title=\"${(item.name || 'Pokedex')}\" height=\"38\">\r\n\t\t<h3 class=\"item-name\">${targetactor.name}</h3>\r\n\t</header>\r\n<div></div>\r\n\t<div class=\"card-content br-text\"> \r\n\t\t<div style=\"text-align:center\">\r\n\t\t\t<img style=\"margin:0px auto;\" src=\"${targetactor.img}\" title=\"${targetactor.name}\" height=\"150\">\r\n\t\t</div>\r\n\t\t<hr>\r\n\t\t<p><strong>Base SR</strong> ${basesr}</p>\r\n     \t<p><strong>Description: </strong>${description}</p>\r\n     </div>\r\n</div></div></div>`\r\n\t};\r\n\tChatMessage.create(chatData, {});\r\n}","author":"7I9uXQmgFHFdAgSd","img":"modules/pokemon-5e/images/pokedex/pokedex-red.png","actorIds":[]}
